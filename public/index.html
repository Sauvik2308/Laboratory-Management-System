<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laboratory Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        header {
            background: #4a5568;
            color: white;
            padding: 25px;
            text-align: center;
        }

        header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .tabs {
            display: flex;
            background: #2d3748;
            overflow-x: auto;
        }

        .tab {
            padding: 15px 25px;
            color: white;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 14px;
            white-space: nowrap;
            transition: background 0.3s;
        }

        .tab:hover {
            background: rgba(255,255,255,0.1);
        }

        .tab.active {
            background: #667eea;
        }

        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px solid #e2e8f0;
        }

        .form-section h3 {
            margin-bottom: 15px;
            color: #2d3748;
            font-size: 18px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 5px;
            color: #4a5568;
            font-size: 14px;
            font-weight: 500;
        }

        input, select, textarea {
            padding: 10px;
            border: 1px solid #cbd5e0;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .btn-warning {
            background: #ed8936;
            color: white;
        }

        .btn-warning:hover {
            background: #dd6b20;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            font-size: 14px;
        }

        th {
            background: #edf2f7;
            color: #2d3748;
            font-weight: 600;
        }

        tr:hover {
            background: #f7fafc;
        }

        .actions {
            display: flex;
            gap: 8px;
        }

        .actions button {
            padding: 6px 12px;
            font-size: 12px;
        }

        .message {
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        .message.success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }

        .message.error {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #fc8181;
        }

        .message.show {
            display: block;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Laboratory Management System</h1>
            <p>Manage your laboratory resources efficiently</p>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="showTab('admin')">Admin</button>
            <button class="tab" onclick="showTab('inventory')">Inventory</button>
            <button class="tab" onclick="showTab('equipment')">Equipment</button>
            <button class="tab" onclick="showTab('staff')">Staff</button>
            <button class="tab" onclick="showTab('roles')">Roles</button>
            <button class="tab" onclick="showTab('student')">Students</button>
            <button class="tab" onclick="showTab('test')">Tests</button>
            <button class="tab" onclick="showTab('report')">Reports</button>
        </div>

        <!-- Search bar (filters current tab) -->
        <div class="search-bar" style="padding:12px 24px; background:#f1f5f9; display:flex; gap:8px; align-items:center;">
            <input id="search-input" type="search" placeholder="Search current tab..." style="flex:1; padding:8px 10px; border:1px solid #cbd5e0; border-radius:6px;">
            <button class="btn btn-primary" onclick="runSearch()" style="padding:8px 12px;">Search</button>
            <button class="btn" onclick="clearSearch()" style="padding:8px 12px; background:#e2e8f0;">Clear</button>
        </div>

        <div class="content">
            <!-- Admin Tab -->
            <div id="admin" class="tab-content active">
                <div class="message" id="admin-message"></div>
                <div class="form-section">
                    <h3>Add/Update Admin</h3>
                    <form id="admin-form">
                        <input type="hidden" id="admin-id">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Email *</label>
                                <input type="email" id="admin-email" required>
                            </div>
                            <div class="form-group">
                                <label>Password *</label>
                                <input type="password" id="admin-password" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Admin</button>
                        <button type="button" class="btn btn-warning" onclick="resetForm('admin')">Reset</button>
                    </form>
                </div>
                <div class="table-container">
                    <table id="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Email</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Inventory Tab -->
            <div id="inventory" class="tab-content">
                <div class="message" id="inventory-message"></div>
                <div class="form-section">
                    <h3>Add/Update Inventory Item</h3>
                    <form id="inventory-form">
                        <input type="hidden" id="inventory-id">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Type *</label>
                                <input type="text" id="inventory-type" required>
                            </div>
                            <div class="form-group">
                                <label>Quantity *</label>
                                <input type="number" id="inventory-quantity" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Item</button>
                        <button type="button" class="btn btn-warning" onclick="resetForm('inventory')">Reset</button>
                    </form>
                </div>
                <div class="table-container">
                    <table id="inventory-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Type</th>
                                <th>Quantity</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Equipment Tab -->
            <div id="equipment" class="tab-content">
                <div class="message" id="equipment-message"></div>
                <div class="form-section">
                    <h3>Add/Update Equipment</h3>
                    <form id="equipment-form">
                        <input type="hidden" id="equipment-id">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Type *</label>
                                <input type="text" id="equipment-type" required>
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="equipment-desc"></textarea>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Equipment</button>
                        <button type="button" class="btn btn-warning" onclick="resetForm('equipment')">Reset</button>
                    </form>
                </div>
                <div class="table-container">
                    <table id="equipment-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Type</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Staff Tab -->
            <div id="staff" class="tab-content">
                <div class="message" id="staff-message"></div>
                <div class="form-section">
                    <h3>Add/Update Staff</h3>
                    <form id="staff-form">
                        <input type="hidden" id="staff-id">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Name *</label>
                                <input type="text" id="staff-name" required>
                            </div>
                            <div class="form-group">
                                <label>Email *</label>
                                <input type="email" id="staff-email" required>
                            </div>
                            <div class="form-group">
                                <label>Mobile</label>
                                <input type="text" id="staff-mobile">
                            </div>
                            <div class="form-group">
                                <label>Role</label>
                                <input type="text" id="staff-role">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Staff</button>
                        <button type="button" class="btn btn-warning" onclick="resetForm('staff')">Reset</button>
                    </form>
                </div>
                <div class="table-container">
                    <table id="staff-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Mobile</th>
                                <th>Role</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Roles Tab -->
            <div id="roles" class="tab-content">
                <div class="message" id="roles-message"></div>
                <div class="form-section">
                    <h3>Add/Update Role</h3>
                    <form id="roles-form">
                        <input type="hidden" id="roles-id">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Role Name *</label>
                                <input type="text" id="roles-name" required>
                            </div>
                            <div class="form-group">
                                <label>Strength/Level</label>
                                <input type="text" id="roles-strength">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Role</button>
                        <button type="button" class="btn btn-warning" onclick="resetForm('roles')">Reset</button>
                    </form>
                </div>
                <div class="table-container">
                    <table id="roles-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Strength</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Student Tab -->
            <div id="student" class="tab-content">
                <div class="message" id="student-message"></div>
                <div class="form-section">
                    <h3>Add/Update Student</h3>
                    <form id="student-form">
                        <input type="hidden" id="student-id">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Name *</label>
                                <input type="text" id="student-name" required>
                            </div>
                            <div class="form-group">
                                <label>Email *</label>
                                <input type="email" id="student-email" required>
                            </div>
                            <div class="form-group">
                                <label>Mobile</label>
                                <input type="text" id="student-mobile">
                            </div>
                            <div class="form-group">
                                <label>Department</label>
                                <input type="text" id="student-dept">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Student</button>
                        <button type="button" class="btn btn-warning" onclick="resetForm('student')">Reset</button>
                    </form>
                </div>
                <div class="table-container">
                    <table id="student-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Mobile</th>
                                <th>Department</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Test Tab -->
            <div id="test" class="tab-content">
                <div class="message" id="test-message"></div>
                <div class="form-section">
                    <h3>Add/Update Test</h3>
                    <form id="test-form">
                        <input type="hidden" id="test-id">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Student ID *</label>
                                <input type="number" id="test-student-id" required>
                            </div>
                            <div class="form-group">
                                <label>Staff ID</label>
                                <input type="number" id="test-staff-id">
                            </div>
                            <div class="form-group">
                                <label>Type *</label>
                                <input type="text" id="test-type" required>
                            </div>
                            <div class="form-group">
                                <label>Date *</label>
                                <input type="date" id="test-date" required>
                            </div>
                            <div class="form-group">
                                <label>Result</label>
                                <input type="text" id="test-result">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Test</button>
                        <button type="button" class="btn btn-warning" onclick="resetForm('test')">Reset</button>
                    </form>
                </div>
                <div class="table-container">
                    <table id="test-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Student ID</th>
                                <th>Staff ID</th>
                                <th>Type</th>
                                <th>Date</th>
                                <th>Result</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Report Tab -->
            <div id="report" class="tab-content">
                <div class="message" id="report-message"></div>
                <div class="form-section">
                    <h3>Add/Update Report</h3>
                    <form id="report-form">
                        <input type="hidden" id="report-id">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Staff ID</label>
                                <input type="number" id="report-staff-id">
                            </div>
                            <div class="form-group">
                                <label>Test ID</label>
                                <input type="number" id="report-test-id">
                            </div>
                            <div class="form-group">
                                <label>Type</label>
                                <input type="text" id="report-type">
                            </div>
                            <div class="form-group">
                                <label>Date *</label>
                                <input type="date" id="report-date" required>
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="report-desc"></textarea>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Report</button>
                        <button type="button" class="btn btn-warning" onclick="resetForm('report')">Reset</button>
                    </form>
                </div>
                <div class="table-container">
                    <table id="report-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Staff ID</th>
                                <th>Test ID</th>
                                <th>Type</th>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/api';
        // track currently active tab (used by search)
        let currentTab = 'admin';

        function showTab(tabName) {
            // set current tab
            currentTab = tabName;

            // Remove active class from all tabs and contents
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // Add active class to selected tab button (match by onclick attribute) and to content
            const btn = document.querySelector(`.tab[onclick="showTab('${tabName}')"]`);
            if (btn) btn.classList.add('active');
            const contentEl = document.getElementById(tabName);
            if (contentEl) contentEl.classList.add('active');

            // clear any existing search input when switching tabs
            const sInput = document.getElementById('search-input');
            if (sInput) sInput.value = '';

            // Load data for the selected tab
            loadData(tabName);
        }

        function showMessage(entity, message, type) {
            const msgEl = document.getElementById(`${entity}-message`);
            msgEl.textContent = message;
            msgEl.className = `message ${type} show`;
            setTimeout(() => msgEl.classList.remove('show'), 3000);
        }

        async function loadData(entity) {
            try {
                const response = await fetch(`${API_URL}/${entity}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                displayData(entity, data);
            } catch (error) {
                console.error('Error loading data for ' + entity + ':', error);
                // Show empty table if there's an error
                displayData(entity, []);
            }
        }

        // Search helper: fetch current tab data then filter client-side
        async function runSearch() {
            const termEl = document.getElementById('search-input');
            if (!termEl) return;
            const term = termEl.value.trim().toLowerCase();
            // If empty, just reload original data
            if (!term) return loadData(currentTab);

            try {
                const res = await fetch(`${API_URL}/${currentTab}`);
                if (!res.ok) throw new Error('Network response not ok');
                const data = await res.json();

                // Filter: any field that includes the search term
                const filtered = (data || []).filter(item => {
                    return Object.values(item).some(val => {
                        if (val === null || val === undefined) return false;
                        return String(val).toLowerCase().includes(term);
                    });
                });

                displayData(currentTab, filtered);
            } catch (err) {
                console.error('Search error:', err);
                // fallback to showing nothing
                displayData(currentTab, []);
            }
        }

        function clearSearch() {
            const termEl = document.getElementById('search-input');
            if (termEl) termEl.value = '';
            loadData(currentTab);
        }

        // run search when user presses Enter inside the search input
        (function attachSearchEnter() {
            const el = document.getElementById('search-input');
            if (!el) return;
            el.addEventListener('keyup', function (e) {
                if (e.key === 'Enter') runSearch();
            });
        })();

        function displayData(entity, data) {
            const tbody = document.querySelector(`#${entity}-table tbody`);
            if (!tbody) {
                console.error('Table not found for entity:', entity);
                return;
            }
            
            tbody.innerHTML = '';
            
            if (data.length === 0) {
                const colCount = tbody.parentElement.querySelector('thead tr').children.length;
                tbody.innerHTML = `<tr><td colspan="${colCount}" style="text-align: center; padding: 20px; color: #718096;">No data available. Add some records to get started!</td></tr>`;
                return;
            }
            
            data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = createRowHTML(entity, item);
                tbody.appendChild(row);
            });
        }

        function createRowHTML(entity, item) {
            switch(entity) {
                case 'admin':
                    return `
                        <td>${item.A_ID}</td>
                        <td>${item.A_EMAIL}</td>
                        <td class="actions">
                            <button class="btn btn-warning" onclick="editItem('admin', ${item.A_ID})">Edit</button>
                            <button class="btn btn-danger" onclick="deleteItem('admin', ${item.A_ID})">Delete</button>
                        </td>
                    `;
                case 'inventory':
                    return `
                        <td>${item.I_ID}</td>
                        <td>${item.E_TYPE}</td>
                        <td>${item.QUANTITY}</td>
                        <td class="actions">
                            <button class="btn btn-warning" onclick="editItem('inventory', ${item.I_ID})">Edit</button>
                            <button class="btn btn-danger" onclick="deleteItem('inventory', ${item.I_ID})">Delete</button>
                        </td>
                    `;
                case 'equipment':
                    return `
                        <td>${item.E_ID}</td>
                        <td>${item.E_TYPE}</td>
                        <td>${item.E_DESC || ''}</td>
                        <td class="actions">
                            <button class="btn btn-warning" onclick="editItem('equipment', ${item.E_ID})">Edit</button>
                            <button class="btn btn-danger" onclick="deleteItem('equipment', ${item.E_ID})">Delete</button>
                        </td>
                    `;
                case 'staff':
                    return `
                        <td>${item.SF_ID}</td>
                        <td>${item.SF_NAME}</td>
                        <td>${item.SF_EMAIL}</td>
                        <td>${item.SF_MOBILE || ''}</td>
                        <td>${item.SF_ROLE || ''}</td>
                        <td class="actions">
                            <button class="btn btn-warning" onclick="editItem('staff', ${item.SF_ID})">Edit</button>
                            <button class="btn btn-danger" onclick="deleteItem('staff', ${item.SF_ID})">Delete</button>
                        </td>
                    `;
                case 'roles':
                    return `
                        <td>${item.NAME}</td>
                        <td>${item.STRENGTH || ''}</td>
                        <td class="actions">
                            <button class="btn btn-warning" onclick="editItem('roles', '${item.NAME}')">Edit</button>
                            <button class="btn btn-danger" onclick="deleteItem('roles', '${item.NAME}')">Delete</button>
                        </td>
                    `;
                case 'student':
                    return `
                        <td>${item.S_ID}</td>
                        <td>${item.S_NAME}</td>
                        <td>${item.S_EMAIL}</td>
                        <td>${item.S_MOBILE || ''}</td>
                        <td>${item.S_DEPT || ''}</td>
                        <td class="actions">
                            <button class="btn btn-warning" onclick="editItem('student', ${item.S_ID})">Edit</button>
                            <button class="btn btn-danger" onclick="deleteItem('student', ${item.S_ID})">Delete</button>
                        </td>
                    `;
                case 'test':
                    return `
                        <td>${item.T_ID}</td>
                        <td>${item.S_ID}</td>
                        <td>${item.SF_ID || ''}</td>
                        <td>${item.T_TYPE}</td>
                        <td>${item.DATE}</td>
                        <td>${item.RESULT || ''}</td>
                        <td class="actions">
                            <button class="btn btn-warning" onclick="editItem('test', ${item.T_ID})">Edit</button>
                            <button class="btn btn-danger" onclick="deleteItem('test', ${item.T_ID})">Delete</button>
                        </td>
                    `;
                case 'report':
                    return `
                        <td>${item.R_ID}</td>
                        <td>${item.S_ID || ''}</td>
                        <td>${item.T_ID || ''}</td>
                        <td>${item.R_TYPE || ''}</td>
                        <td>${item.R_DATE}</td>
                        <td>${item.R_DESC || ''}</td>
                        <td class="actions">
                            <button class="btn btn-warning" onclick="editItem('report', ${item.R_ID})">Edit</button>
                            <button class="btn btn-danger" onclick="deleteItem('report', ${item.R_ID})">Delete</button>
                        </td>
                    `;
            }
        }

        async function editItem(entity, id) {
            try {
                const response = await fetch(`${API_URL}/${entity}/${id}`);
                const item = await response.json();
                fillForm(entity, item);
            } catch (error) {
                console.error('Error loading item:', error);
            }
        }

        function fillForm(entity, item) {
            switch(entity) {
                case 'admin':
                    document.getElementById('admin-id').value = item.A_ID;
                    document.getElementById('admin-email').value = item.A_EMAIL;
                    document.getElementById('admin-password').value = '';
                    break;
                case 'inventory':
                    document.getElementById('inventory-id').value = item.I_ID;
                    document.getElementById('inventory-type').value = item.E_TYPE;
                    document.getElementById('inventory-quantity').value = item.QUANTITY;
                    break;
                case 'equipment':
                    document.getElementById('equipment-id').value = item.E_ID;
                    document.getElementById('equipment-type').value = item.E_TYPE;
                    document.getElementById('equipment-desc').value = item.E_DESC || '';
                    break;
                case 'staff':
                    document.getElementById('staff-id').value = item.SF_ID;
                    document.getElementById('staff-name').value = item.SF_NAME;
                    document.getElementById('staff-email').value = item.SF_EMAIL;
                    document.getElementById('staff-mobile').value = item.SF_MOBILE || '';
                    document.getElementById('staff-role').value = item.SF_ROLE || '';
                    break;
                case 'roles':
                    document.getElementById('roles-id').value = item.NAME;
                    document.getElementById('roles-name').value = item.NAME;
                    document.getElementById('roles-strength').value = item.STRENGTH || '';
                    break;
                case 'student':
                    document.getElementById('student-id').value = item.S_ID;
                    document.getElementById('student-name').value = item.S_NAME;
                    document.getElementById('student-email').value = item.S_EMAIL;
                    document.getElementById('student-mobile').value = item.S_MOBILE || '';
                    document.getElementById('student-dept').value = item.S_DEPT || '';
                    break;
                case 'test':
                    document.getElementById('test-id').value = item.T_ID;
                    document.getElementById('test-student-id').value = item.S_ID;
                    document.getElementById('test-staff-id').value = item.SF_ID || '';
                    document.getElementById('test-type').value = item.T_TYPE;
                    document.getElementById('test-date').value = item.DATE;
                    document.getElementById('test-result').value = item.RESULT || '';
                    break;
                case 'report':
                    document.getElementById('report-id').value = item.R_ID;
                    document.getElementById('report-staff-id').value = item.S_ID || '';
                    document.getElementById('report-test-id').value = item.T_ID || '';
                    document.getElementById('report-type').value = item.R_TYPE || '';
                    document.getElementById('report-date').value = item.R_DATE;
                    document.getElementById('report-desc').value = item.R_DESC || '';
                    break;
            }
        }

        async function deleteItem(entity, id) {
            if (!confirm('Are you sure you want to delete this item?')) return;
            
            try {
                const response = await fetch(`${API_URL}/${entity}/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showMessage(entity, 'Item deleted successfully', 'success');
                    loadData(entity);
                } else {
                    showMessage(entity, 'Error deleting item', 'error');
                }
            } catch (error) {
                showMessage(entity, 'Error deleting item', 'error');
            }
        }

        function resetForm(entity) {
            document.getElementById(`${entity}-form`).reset();
            document.getElementById(`${entity}-id`).value = '';
        }

        // Form submissions
        document.getElementById('admin-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('admin-id').value;
            const data = {
                A_EMAIL: document.getElementById('admin-email').value,
                A_PW: document.getElementById('admin-password').value
            };
            await saveData('admin', data, id);
        });

        document.getElementById('inventory-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('inventory-id').value;
            const data = {
                E_TYPE: document.getElementById('inventory-type').value,
                QUANTITY: document.getElementById('inventory-quantity').value
            };
            await saveData('inventory', data, id);
        });

        document.getElementById('equipment-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('equipment-id').value;
            const data = {
                E_TYPE: document.getElementById('equipment-type').value,
                E_DESC: document.getElementById('equipment-desc').value
            };
            await saveData('equipment', data, id);
        });

        document.getElementById('staff-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('staff-id').value;
            const data = {
                SF_NAME: document.getElementById('staff-name').value,
                SF_EMAIL: document.getElementById('staff-email').value,
                SF_MOBILE: document.getElementById('staff-mobile').value,
                SF_ROLE: document.getElementById('staff-role').value
            };
            await saveData('staff', data, id);
        });

        document.getElementById('roles-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('roles-id').value;
            const data = {
                NAME: document.getElementById('roles-name').value,
                STRENGTH: document.getElementById('roles-strength').value
            };
            await saveData('roles', data, id);
        });

        document.getElementById('student-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('student-id').value;
            const data = {
                S_NAME: document.getElementById('student-name').value,
                S_EMAIL: document.getElementById('student-email').value,
                S_MOBILE: document.getElementById('student-mobile').value,
                S_DEPT: document.getElementById('student-dept').value
            };
            await saveData('student', data, id);
        });

        document.getElementById('test-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('test-id').value;
            const data = {
                S_ID: document.getElementById('test-student-id').value,
                SF_ID: document.getElementById('test-staff-id').value,
                T_TYPE: document.getElementById('test-type').value,
                DATE: document.getElementById('test-date').value,
                RESULT: document.getElementById('test-result').value
            };
            await saveData('test', data, id);
        });

        document.getElementById('report-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('report-id').value;
            const data = {
                S_ID: document.getElementById('report-staff-id').value,
                T_ID: document.getElementById('report-test-id').value,
                R_TYPE: document.getElementById('report-type').value,
                R_DATE: document.getElementById('report-date').value,
                R_DESC: document.getElementById('report-desc').value
            };
            await saveData('report', data, id);
        });

        async function saveData(entity, data, id) {
            try {
                const url = id ? `${API_URL}/${entity}/${id}` : `${API_URL}/${entity}`;
                const method = id ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    showMessage(entity, `${id ? 'Updated' : 'Added'} successfully`, 'success');
                    resetForm(entity);
                    loadData(entity);
                } else {
                    showMessage(entity, 'Error saving data', 'error');
                }
            } catch (error) {
                showMessage(entity, 'Error saving data', 'error');
            }
        }

        // Load initial data
        loadData('admin');
    </script>